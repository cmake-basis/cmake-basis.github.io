<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="This BASIS how-to describes the basistest family of scripts and the process which was implemented at SBIA for the automated software test execution." name="description" />

    <title>Automated Testing &mdash; BASIS</title>
    
    <link rel="stylesheet" href="../_static/cmake-basis.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'v3.3 (fb18c98)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="BASIS" href="../index.html" />
    <link rel="up" title="How-to Guides" href="../howto.html" />
    <link rel="next" title="Standards" href="../standard.html" />
    <link rel="prev" title="Install any Software" href="install.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
  
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../standard.html" title="Standards"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="install.html" title="Install any Software"
             accesskey="P">previous</a> |</li>
        <li><a href="../sidebar.html">BASIS</a> &raquo;</li>
          <li><a href="../howto.html" accesskey="U">How-to Guides</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="automated-testing">
<h1>Automated Testing<a class="headerlink" href="#automated-testing" title="Permalink to this headline">¶</a></h1>
<p>This how-to guide describes the implementation and configuration of
automated tests of software implemented on top of BASIS. Note that this guide
is mainly of interest for software maintainers who have permissions to change
the configuration of the software testing process and system administrators.
Other lab members and software developers generally do not need to bother with
these details. Note, however, that the automated tests can generally also be
setup on any machine outside the lab. But in order for <a class="reference external" href="http://www.cmake.org/cmake/help/v2.8.8/ctest.html">CTest</a> to be able to
submit test results to the CDash server, a VPN connection to the
University of Pennsylvania Health System (UPHS) network is required.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This how-to guide details the automated software testing at SBIA
and is therefore specific to the lab&#8217;s computing environment.</p>
</div>
<div class="section" id="the-basistest-family-of-scripts">
<span id="basistestscripts"></span><h2>The basistest family of scripts<a class="headerlink" href="#the-basistest-family-of-scripts" title="Permalink to this headline">¶</a></h2>
<p>The BASIS package comes with a family of scripts whose name starts with
the prefix <code class="docutils literal"><span class="pre">basistest</span></code>. All these scripts respond to the usual command-line
options such as <code class="docutils literal"><span class="pre">--help</span></code> and <code class="docutils literal"><span class="pre">--version</span></code> to provide detailed
information regarding usage and version. Further, a wrapper script named
<code class="docutils literal"><span class="pre">basistest</span></code> is available which understands the subcommands <code class="docutils literal"><span class="pre">cron</span></code>,
<code class="docutils literal"><span class="pre">master</span></code>, <code class="docutils literal"><span class="pre">slave</span></code> (the default), and <code class="docutils literal"><span class="pre">svn</span></code>.</p>
<ul>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a>:</dt>
<dd><p class="first last">The command executed by the scheduled cron job.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#basistestmaster"><span class="std std-ref">basistest-master</span></a>:</dt>
<dd><p class="first last">The master script which runs the scheduled tests.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#basistestslave"><span class="std std-ref">basistest-slave</span></a>:</dt>
<dd><p class="first last">The test execution command which is executed by the master script for each test job.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#basistestsvn"><span class="std std-ref">basistest-svn</span></a>:</dt>
<dd><p class="first last">The wrapper for the <a class="reference external" href="http://svnbook.red-bean.com/en/1.7/svn.ref.svn.html">svn</a> command which can be run non-interactively.</p>
</dd>
</dl>
</li>
</ul>
<div class="section" id="basistest-cron">
<span id="basistestcron"></span><h3>basistest-cron<a class="headerlink" href="#basistest-cron" title="Permalink to this headline">¶</a></h3>
<p>This command is run by a cron job. The configuration of the test execution command is
coded into this script, optionally including the submission command used to submit
test jobs to the batch-queuing system such as the <a class="reference external" href="http://en.wikipedia.org/wiki/Oracle_Grid_Engine">Oracle Grid Engine</a>,
formerly known as Sun Grid Engine (SGE), in particular. Moreover, the location of the
test configuration file and test schedule file, both used by the <code class="docutils literal"><span class="pre">basistest-master</span></code>
script, are specified here. Another reason for implementing this script is the setup
of the environment for the execution of the master script because cron jobs are run
with a minimal configuration of environment variables. Therefore, the <code class="docutils literal"><span class="pre">basistest-cron</span></code>
script sources the <code class="docutils literal"><span class="pre">~swtest/.bashrc</span></code> file of the <code class="docutils literal"><span class="pre">swtest</span></code> user which is used at
our lab for the automated software testing in order to, for example, add the
<code class="docutils literal"><span class="pre">~swtest/bin/</span></code> directory where all the <code class="docutils literal"><span class="pre">basistest</span></code> scripts are installed to the
<code class="docutils literal"><span class="pre">PATH</span></code> environment variable.</p>
</div>
<div class="section" id="basistest-master">
<span id="basistestmaster"></span><h3>basistest-master<a class="headerlink" href="#basistest-master" title="Permalink to this headline">¶</a></h3>
<p>This so-called master script is executed by the <code class="docutils literal"><span class="pre">basistest-cron</span></code> command.
On each run, it reads in the configuration file given by the <code class="docutils literal"><span class="pre">--config</span></code> option
line-by-line. Each line in the configuration file specifies one test job to be executed.
The format of the configuration file is detailed here. Comments within the configuration
file start with a pound (#) character at the beginning of each line.</p>
<p>For each test of a specific branch of a project, the configuration file contains a
line following the format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">m</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">h</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">d</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">project</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">model</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">options</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">m</span><span class="o">&gt;</span>         <span class="n">Interval</span> <span class="ow">in</span> <span class="n">minutes</span> <span class="n">between</span> <span class="n">consecutive</span> <span class="n">test</span> <span class="n">runs</span><span class="o">.</span>
            <span class="n">Defaults</span> <span class="n">to</span> <span class="s2">&quot;0&quot;</span> <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">is</span> <span class="n">given</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">h</span><span class="o">&gt;</span>         <span class="n">Interval</span> <span class="ow">in</span> <span class="n">hours</span> <span class="n">between</span> <span class="n">consecutive</span> <span class="n">test</span> <span class="n">runs</span><span class="o">.</span>
            <span class="n">Defaults</span> <span class="n">to</span> <span class="s2">&quot;0&quot;</span> <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">is</span> <span class="n">given</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">d</span><span class="o">&gt;</span>         <span class="n">Interval</span> <span class="ow">in</span> <span class="n">days</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span> <span class="n">multiples</span> <span class="n">of</span> <span class="mi">24</span> <span class="n">hours</span><span class="p">)</span> <span class="n">between</span> <span class="n">consecutive</span>
            <span class="n">test</span> <span class="n">runs</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="s2">&quot;0&quot;</span> <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">is</span> <span class="n">given</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">project</span><span class="o">&gt;</span>   <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">BASIS</span> <span class="n">project</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span>    <span class="n">Branch</span> <span class="n">within</span> <span class="n">the</span> <span class="n">project</span><span class="s1">&#39;s SVN repository, e.g., &quot;tags/1.0.0&quot;.</span>
            <span class="n">Defaults</span> <span class="n">to</span> <span class="s2">&quot;trunk&quot;</span> <span class="k">if</span> <span class="n">a</span> <span class="s2">&quot;*&quot;</span> <span class="ow">is</span> <span class="n">given</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">model</span><span class="o">&gt;</span>     <span class="n">Dashboard</span> <span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span> <span class="n">either</span> <span class="n">one</span> <span class="n">of</span> <span class="s2">&quot;Nightly&quot;</span><span class="p">,</span> <span class="s2">&quot;Continuous&quot;</span><span class="p">,</span>
            <span class="ow">and</span> <span class="s2">&quot;Experimental&quot;</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="s2">&quot;Nightly&quot;</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">options</span><span class="o">&gt;</span>   <span class="n">Additional</span> <span class="n">options</span> <span class="n">to</span> <span class="n">the</span> <span class="n">CTest</span> <span class="n">script</span><span class="o">.</span>
            <span class="n">The</span> <span class="s2">&quot;basisctest&quot;</span> <span class="n">script</span> <span class="n">of</span> <span class="n">BASIS</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span>
            <span class="n">Run</span> <span class="s2">&quot;ctest -S &lt;path&gt;/basistest.ctest,help&quot;</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span>
            <span class="n">available</span> <span class="n">options</span><span class="o">.</span> <span class="n">By</span> <span class="n">default</span><span class="p">,</span> <span class="n">the</span> <span class="n">default</span> <span class="n">options</span> <span class="n">of</span> <span class="n">the</span>
            <span class="n">CTest</span> <span class="n">script</span> <span class="n">are</span> <span class="n">used</span><span class="o">.</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">this</span> <span class="n">option</span> <span class="n">can</span> <span class="ow">in</span> <span class="n">particular</span>
            <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">define</span> <span class="n">CMake</span> <span class="n">variables</span> <span class="k">for</span> <span class="n">the</span> <span class="n">build</span> <span class="n">configuration</span><span class="o">.</span>
</pre></div>
</div>
<p>Note that either &lt;m&gt;, &lt;h&gt;, or &lt;d&gt; needs to be a positive number such that the
interval is valid. Otherwise, the master script will report a configuration error
and skip the test.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Neither of these entries may contain any whitespace character!</p>
</div>
<p>For example, nightly tests of the main development branch (trunk) of the
project BASIS itself which are run once every day including coverage analysis
are scheduled by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">*</span> <span class="mi">1</span> <span class="n">BASIS</span> <span class="n">trunk</span> <span class="n">Nightly</span> <span class="n">coverage</span><span class="p">,</span><span class="n">memcheck</span>
</pre></div>
</div>
<p>Besides the configuration file, which has to be edited manually, a test schedule
file is maintained by the testing master. For each configured test job, the master
consults the current schedule to see whether the test is already due for execution
given the testing interval specified in the configuration file and the last time
the test was executed. If the test is due for execution, the testing command,
i.e., by default the <a class="reference internal" href="#basistestslave"><span class="std std-ref">basistest-slave</span></a>, is executed and the test schedule
updated by the testing master. Otherwise, the execution of the test is skipped.</p>
</div>
<div class="section" id="basistest-slave">
<span id="basistestslave"></span><h3>basistest-slave<a class="headerlink" href="#basistest-slave" title="Permalink to this headline">¶</a></h3>
<p>This script wraps the execution of the CTest script used for the automated
testing of BASIS projects including the submission of the test results to the
<a class="reference external" href="https://sbia-portal.uphs.upenn.edu/cdash">sbiaCDash</a> server. It mainly converts the command-line arguments to the correct
command-line for the invocation of the CTest script.</p>
<p>The <a class="reference external" href="https://cmake-basis.github.io/apidoc/latest/basistest_8ctest.html">basistest.ctest</a> script performs the actual testing of a BASIS
project, i.e., the</p>
<ul class="simple">
<li>initial check out of the sources from the Subversion controlled repository,</li>
<li>update of an existing working copy,</li>
<li>build of the test executables,</li>
<li>execution of the tests,</li>
<li>optional coverage analysis,</li>
<li>optional memory checks,</li>
<li>submission of test results to the CDash server.</li>
</ul>
<p>Run the following command in a shell to have the CTest script print its help
to screen and exit. However, the <code class="docutils literal"><span class="pre">basistest-slave</span></code> script should be
used instead of executing this CTest script directly. The help displayed by this
command can be used in order to determine which additional options
are available (such as <code class="docutils literal"><span class="pre">coverage</span></code> and <code class="docutils literal"><span class="pre">memcheck</span></code>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">S</span> <span class="n">basistest</span><span class="o">.</span><span class="n">ctest</span><span class="p">,</span><span class="n">help</span>
</pre></div>
</div>
</div>
<div class="section" id="basistest-svn">
<span id="basistestsvn"></span><h3>basistest-svn<a class="headerlink" href="#basistest-svn" title="Permalink to this headline">¶</a></h3>
<p>This script simply wraps the execution of the <a class="reference external" href="http://svnbook.red-bean.com/en/1.7/svn.ref.svn.html">svn</a> command as the <code class="docutils literal"><span class="pre">svnuser</span></code>
user as this allows for non-interactive check outs and updates of working
copies without the need to provide a user name and password. The code of the
script is at the moment the single line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">exec</span> <span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">svnuser</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">/</span><span class="n">sbia</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">svn</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">svnwrap</span> <span class="s2">&quot;$@&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is another wrapper script named <code class="docutils literal"><span class="pre">svnwrap</span></code> owned by
the <code class="docutils literal"><span class="pre">svnuser</span></code> involved which does the actual invocation of the
<code class="docutils literal"><span class="pre">svn</span></code> command.</p>
</div>
</div>
</div>
<div class="section" id="cdash-integration">
<span id="howtointegratecdash"></span><h2>CDash Integration<a class="headerlink" href="#cdash-integration" title="Permalink to this headline">¶</a></h2>
<p>The first step for <a class="reference external" href="http://www.cdash.org/">CDash</a> integration is to set up a CDash server by following
the instructions provided in the CDash documentation.</p>
<p>Then you need to create a project on the CDash site of your server through the
Admin interface.</p>
<p>Finally, you can configure CTest through the <span>CTestConfig.cmake</span> file
which must be in a project&#8217;s top-level directory to specify the URL of the
CDash server as well as the project to submit test results to.</p>
<p>Running tests via <code class="docutils literal"><span class="pre">ctest</span></code> (<strong>not</strong> <code class="docutils literal"><span class="pre">make</span> <span class="pre">test</span></code>) will then try to submit the
results to the CDash server.</p>
</div>
<div class="section" id="administration-of-software-testing">
<span id="administrationofautomatedtests"></span><h2>Administration of Software Testing<a class="headerlink" href="#administration-of-software-testing" title="Permalink to this headline">¶</a></h2>
<p>The following describes the setup and configuration of the automated software
tests at SBIA. Hence, these instructions are only of interest for the
administrators of the automated software testing at our lab. Other users
do not have the permission to become the <code class="docutils literal"><span class="pre">swtest</span></code> user.
To become the <code class="docutils literal"><span class="pre">swtest</span></code> user execute:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">swtest</span> <span class="n">sudosh</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to start with a clean setup, keep in mind that the
directories <code class="docutils literal"><span class="pre">~swtest/etc/</span></code> and <code class="docutils literal"><span class="pre">~swtest/var/</span></code> contain
files which are not part of the BASIS project.
These need to be preserved and backed up separately.</p>
</div>
<div class="section" id="initial-basis-installation">
<span id="automatedtestinginstallation"></span><h3>Initial BASIS Installation<a class="headerlink" href="#initial-basis-installation" title="Permalink to this headline">¶</a></h3>
<p>The testing scripts described above are part of the BASIS project.
As long as this project is not installed system-wide, it has to be
installed locally for use by the <code class="docutils literal"><span class="pre">swtest</span></code> user.
Executing the following commands as this testing user will install BASIS
locally in its home directory.</p>
<ol class="arabic simple">
<li>Check-out the BASIS sources into the directory <code class="docutils literal"><span class="pre">~swtest/src/</span></code>:</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span>
svn --username &lt;your own username&gt; co <span class="s2">&quot;https://sbia-svn/projects/BASIS/trunk&quot;</span> src
</pre></div>
</div>
<p>2. Create a directory for the build tree and configure it such that BASIS
will be installed in the home directory of the <code class="docutils literal"><span class="pre">swtest`</span></code> user:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
ccmake -DINSTALL_PREFIX:PATH<span class="o">=</span>~ -DINSTALL_SINFIX:BOOL<span class="o">=</span>OFF <span class="se">\</span>
        -DINSTALL_LINKS:BOOL<span class="o">=</span>OFF <span class="se">\</span>
        -DBUILD_DOCUMENTATION:BOOL<span class="o">=</span>OFF <span class="se">\</span>
        -DBUILD_EXAMPLE:BOOL<span class="o">=</span>OFF <span class="se">\</span>
        -DBUILD_TESTING:BOOL<span class="o">=</span>OFF <span class="se">\</span>
        ../src
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first">Build and install BASIS with <code class="docutils literal"><span class="pre">~swtest</span></code> as installation prefix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
</ol>
<p>The testing scripts described above are then installed in the directory
<code class="docutils literal"><span class="pre">~swtest/bin/</span></code> and the CTest script is located in <code class="docutils literal"><span class="pre">~swtest/share/cmake/</span></code>.</p>
</div>
<div class="section" id="updating-the-basis-installation">
<span id="updateofautomatedtestinginstallation"></span><h3>Updating the BASIS Installation<a class="headerlink" href="#updating-the-basis-installation" title="Permalink to this headline">¶</a></h3>
<p>In order to update the testing scripts, run the following commands as
the <code class="docutils literal"><span class="pre">swtest</span></code> user on <code class="docutils literal"><span class="pre">olympus</span></code> (this is important because the cron job which
executes the tests will run on <code class="docutils literal"><span class="pre">olympus</span></code>).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span>
svn up src
cmake build
make -C build install
make clean
</pre></div>
</div>
<p>This updates the working copy of the BASIS sources in <code class="docutils literal"><span class="pre">~swtest/src/</span></code>
and builds the project in the build tree <code class="docutils literal"><span class="pre">~swtest/build/</span></code>.
Finally, the updated BASIS project is installed. Note that the explicit
execution of CMake might be redundant. However, some modifications may
not re-trigger a configuration even though it is required. Thus, it is
better to run CMake manually before the make. The final
<code class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span></code> is optional. It is done in order to remove the temporary
object and binary files from the build tree and thus reduce the disk space occupied.</p>
</div>
<div class="section" id="configuring-test-jobs">
<span id="configurationofautomatedtests"></span><h3>Configuring Test Jobs<a class="headerlink" href="#configuring-test-jobs" title="Permalink to this headline">¶</a></h3>
<div class="section" id="setting-up-the-test-environment">
<h4>Setting up the Test Environment<a class="headerlink" href="#setting-up-the-test-environment" title="Permalink to this headline">¶</a></h4>
<p>All tests are executed by the <code class="docutils literal"><span class="pre">swtest</span></code> user. Therefore, the common test
environment can be set up in the <code class="docutils literal"><span class="pre">~swtest/.bashrc</span></code> file. Here, the
<a class="reference external" href="http://modules.sourceforge.net/">environment modules</a> which are required by all tests should be loaded.
Moreover, a particular project can depend on another project and should always be
build using the most recent version of that other project. Every BASIS project,
in particular, depends on BASIS. Thus, after each successful test of a project
which is required by other projects, the files of this project are installed
locally in the home directory of the <code class="docutils literal"><span class="pre">swtest</span></code> user. By setting the <code class="docutils literal"><span class="pre">&lt;Pkg&gt;_DIR</span></code>
environment variable, CMake will use this reference installation if available.
Otherwise, it will keep looking in the default system locations.</p>
<p>For an example on how the test environment can be set up, have a look at the
following example lines of the <code class="docutils literal"><span class="pre">~swtest/.bashrc</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># BASIS is required by all tested projects</span>
module load basis
<span class="c1"># ITK 3.* is required by BASIS (for the test driver), HardiTk, GLISTR</span>
module unload itk
module load itk/3.20
<span class="c1"># Boost (&gt;= 1.45) is required by HardiTk</span>
module load boost
<span class="c1"># TRILINOS is required by HardiTk</span>
module load trilinos

<span class="c1"># root directory for installation of project files after successful test execution</span>
<span class="c1">#</span>
<span class="c1"># Note: When logged in on olympus, we usually want to configure</span>
<span class="c1">#       the setup of the test environment such as updating the BASIS</span>
<span class="c1">#       installation used by the automated testing infrastructure itself.</span>
<span class="c1">#       In this case, we actually want to install the files in ~swtest/</span>
<span class="c1">#       and not in the DESTDIR set here.</span>
<span class="k">if</span> ! <span class="o">[[</span> <span class="sb">`</span>hostname<span class="sb">`</span> <span class="o">=</span>~ <span class="s2">&quot;olympus&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">export</span> <span class="nv">DESTDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/comp_space/destdir&quot;</span>
<span class="k">fi</span>

<span class="c1"># Set &lt;Project&gt;_DIR environment variables such that the most recent</span>
<span class="c1"># installations in DESTDIR are used. If a particular installation is</span>
<span class="c1"># not available yet, the default installation as loaded by the module</span>
<span class="c1"># commands above will be used instead.</span>
<span class="nb">export</span> <span class="nv">BASIS_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DESTDIR</span><span class="si">}</span><span class="s2">/usr/local/lib/cmake/basis&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The environment set up this way is common for the build of all tested projects.
Hence, all projects which use ITK will use ITK version 3.20 in this example.
If certain projects would require a different ITK version, the environment for these
test jobs would need to be adjusted before the execution of <code class="docutils literal"><span class="pre">ctest</span></code>. This is
currently not further supported by BASIS, but is an open feature to be implemented.</p>
</div>
</div>
<div class="section" id="adding-test-job-to-basistest-configuration">
<span id="addingteststobasistestconfiguration"></span><h4>Adding Test Job to basistest Configuration<a class="headerlink" href="#adding-test-job-to-basistest-configuration" title="Permalink to this headline">¶</a></h4>
<p>The automated tests of BASIS projects are configured in the test configuration file
of the <a class="reference internal" href="#basistestmaster"><span class="std std-ref">basistest-master</span></a> script. The format of this configuration file is detailed
<a class="reference internal" href="#basistestmaster"><span class="std std-ref">here</span></a>. Where this file is located and how it is named is
configured in the <a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a> script. By default, the <code class="docutils literal"><span class="pre">basistest-master</span></code>
script looks for the file <code class="docutils literal"><span class="pre">/etc/basistest.conf</span></code>, but the current installation is setup
such that the configuration is located in <code class="docutils literal"><span class="pre">~swtest/etc/</span></code>. The current test schedule
file which is maintained and updated by the <a class="reference internal" href="#basistestmaster"><span class="std std-ref">basistest-master</span></a> script is at the moment
saved as <code class="docutils literal"><span class="pre">~swtest/var/run/basistest.schedule</span></code>. The log files of the test executions are
saved in the directory <code class="docutils literal"><span class="pre">~swtest/var/log/</span></code>. Note that these paths are configured
in the <a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a> script. Old log files are deleted by the <a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a>
script after each execution of the test master.</p>
<p>An example test jobs configuration file is given below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># MM HH DD   Project Name      Branch   Dashboard   Arguments</span>
<span class="c1">#                                                   (e.g., build configuration)</span>
<span class="c1"># -----------------------------------------------------------------------------------</span>
<span class="c1"># Note: The destination directory for installations is specified by the DESTDIR</span>
<span class="c1">#       environment variable as set in the ~swtest/.bashrc file as well as the</span>
<span class="c1">#       default CMAKE_INSTALL_PREFIX.</span>
<span class="c1"># -----------------------------------------------------------------------------------</span>
  <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">0</span>    <span class="n">BASIS</span>             <span class="n">trunk</span>    <span class="n">Continuous</span>
  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">1</span>    <span class="n">BASIS</span>             <span class="n">trunk</span>    <span class="n">Nightly</span>     <span class="n">doxygen</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">install</span>
<span class="c1"># -----------------------------------------------------------------------------------</span>
  <span class="mi">0</span>  <span class="mi">6</span>  <span class="mi">0</span>    <span class="n">DRAMMS</span>            <span class="n">trunk</span>    <span class="n">Continuous</span>
  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">1</span>    <span class="n">DRAMMS</span>            <span class="n">trunk</span>    <span class="n">Nightly</span>     <span class="n">doxygen</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">install</span>
<span class="c1"># -----------------------------------------------------------------------------------</span>
  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">1</span>    <span class="n">GLISTR</span>            <span class="n">trunk</span>    <span class="n">Continuous</span>  <span class="n">include</span><span class="o">=</span><span class="n">sbia</span>
  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>    <span class="n">GLISTR</span>            <span class="n">trunk</span>    <span class="n">Nightly</span>     <span class="n">doxygen</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">install</span>
  <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">61</span>    <span class="n">GLISTR</span>            <span class="n">trunk</span>    <span class="n">Nightly</span>     <span class="n">exclude</span><span class="o">=</span><span class="n">sbia</span>  <span class="c1"># non-parallel</span>
<span class="c1"># -----------------------------------------------------------------------------------</span>
  <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">0</span>    <span class="n">HardiTk</span>           <span class="n">trunk</span>    <span class="n">Continuous</span>  <span class="n">BUILD_ALL_MODULES</span><span class="o">=</span><span class="n">ON</span>
  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">1</span>    <span class="n">HardiTk</span>           <span class="n">trunk</span>    <span class="n">Nightly</span>     <span class="n">install</span><span class="p">,</span><span class="n">BUILD_ALL_MODULES</span><span class="o">=</span><span class="n">ON</span>
<span class="c1"># -----------------------------------------------------------------------------------</span>
  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">1</span>    <span class="n">MICO</span>              <span class="n">trunk</span>    <span class="n">Continuous</span>
  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>    <span class="n">MICO</span>              <span class="n">trunk</span>    <span class="n">Nightly</span>     <span class="n">doxygen</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="adjustment-of-test-schedule">
<span id="adjustmentoftestschedule"></span><h4>Adjustment of Test Schedule<a class="headerlink" href="#adjustment-of-test-schedule" title="Permalink to this headline">¶</a></h4>
<p>The current implementation of the <a class="reference internal" href="#basistestmaster"><span class="std std-ref">basistest-master</span></a> script does not allow
to specify specific times at which a test job is to be executed.
It only allows for the specification of the interval between test executions.
Hence, if the test master script is executed the first time with a job that
should be executed every day, the job will be executed immediately and then
every 24 hours later. For nightly tests, it is however often desired to actually
run these tests after midnight (more specifically after the nightly start time
configured in CDash such that the test results are submitted to the dashboard
of the current day). To adjust the time when a test job is executed, one has
to edit the test schedule file (i.e., <code class="docutils literal"><span class="pre">~swtest/var/run/basistest.schedule</span></code>)
manually. This file lists in the first two columns the date and time after
when the next execution of the test job corresponding to the particular row
should be run. Note that the actual execution time depends on when the
<a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a> script is executed. So for the example of nightly test jobs,
the time in the second column for this test job should be changed to &#8220;3:30:00&#8221;
for example. Choosing a time after midnight will show the nightly test results
on the dashboard page of CDash for the &#8220;following&#8221; work day. The nightly test
of BASIS itself which is used by the other projects should be executed first
such that the updated BASIS installation is already used by the other tests.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As the test schedule file is generated by the <a class="reference internal" href="#basistestmaster"><span class="std std-ref">basistest-master</span></a> script,
run either this script or the <a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a> script with the <code class="docutils literal"><span class="pre">--dry</span></code>
option if this file is missing or was not generated yet. This will skip
the immediate execution of all tests, but only create the test schedule
file which then can be edited manually to adjust the times.</p>
</div>
<p>The following is an example of such test schedule file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span> <span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">04</span> <span class="n">BASIS</span> <span class="n">trunk</span> <span class="n">Continuous</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span> <span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">05</span> <span class="n">HardiTk</span> <span class="n">trunk</span> <span class="n">Continuous</span> <span class="n">BUILD_ALL_MODULES</span><span class="o">=</span><span class="n">ON</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">04</span> <span class="n">DRAMMS</span> <span class="n">trunk</span> <span class="n">Continuous</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">BASIS</span> <span class="n">trunk</span> <span class="n">Nightly</span> <span class="n">doxygen</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">install</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">02</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">DRAMMS</span> <span class="n">trunk</span> <span class="n">Nightly</span> <span class="n">doxygen</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">install</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">04</span> <span class="n">GLISTR</span> <span class="n">trunk</span> <span class="n">Continuous</span> <span class="n">include</span><span class="o">=</span><span class="n">sbia</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">02</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">HardiTk</span> <span class="n">trunk</span> <span class="n">Nightly</span> <span class="n">install</span><span class="p">,</span><span class="n">BUILD_ALL_MODULES</span><span class="o">=</span><span class="n">ON</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">05</span> <span class="n">MICO</span> <span class="n">trunk</span> <span class="n">Continuous</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">18</span> <span class="mi">03</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="n">GLISTR</span> <span class="n">trunk</span> <span class="n">Nightly</span> <span class="n">doxygen</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">install</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">18</span> <span class="mi">03</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="n">MICO</span> <span class="n">trunk</span> <span class="n">Nightly</span> <span class="n">doxygen</span><span class="p">,</span><span class="n">memcheck</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">install</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">12</span> <span class="mi">03</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="n">GLISTR</span> <span class="n">trunk</span> <span class="n">Nightly</span> <span class="n">exclude</span><span class="o">=</span><span class="n">sbia</span>
</pre></div>
</div>
<p>Remember that the test schedule is processed by the <a class="reference internal" href="#basistestmaster"><span class="std std-ref">basistest-master</span></a>
script on every script invocation. It will output the scheduled tests in chronic
order of their next due date. If a test has been removed from the test configuration
file, it will also no longer show up in the test schedule.</p>
</div>
<div class="section" id="setting-up-a-cron-job-for-automated-testing">
<span id="testingcronjob"></span><h4>Setting up a Cron Job for Automated Testing<a class="headerlink" href="#setting-up-a-cron-job-for-automated-testing" title="Permalink to this headline">¶</a></h4>
<p>Before you schedule a cron job for the automated software testing, open the
<a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a> script located in the <code class="docutils literal"><span class="pre">~swtest/bin/</span></code> directory and ensure
that the settings are correct.</p>
<p>Then run <a class="reference external" href="http://adminschoice.com/crontab-quick-reference">crontab</a> -e as <code class="docutils literal"><span class="pre">swtest</span></code> user on <code class="docutils literal"><span class="pre">olympus</span></code> and add an entry such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*/</span><span class="mi">5</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">sbia</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">swtest</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">basistest</span> <span class="n">cron</span>
</pre></div>
</div>
<p>This will run the <a class="reference internal" href="#basistestcron"><span class="std std-ref">basistest-cron</span></a> script and hence the testing master
script every 5 minutes on <code class="docutils literal"><span class="pre">olympus</span></code>. Note that the actual interval for executing
the test jobs in particular depends on the test configuration. Hence, even when
the cron job is executed every 5 minutes, the actual tests may only be run once a
night, a week, a month,... depending on the
<a class="reference internal" href="#addingteststobasistestconfiguration"><span class="std std-ref">configuration file</span></a> which is provided
for the <a class="reference internal" href="#basistestmaster"><span class="std std-ref">basistest-master</span></a> script, no matter if any files were modified or not.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <p class="logo"><a href="../index.html">
    <img class="logo" src="../_static/logo_title.svg" alt="Logo"/>
  </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3><a href="../contents.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../howto.html">How-to Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create-and-modify-project.html">Create/Modify a Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="use-and-customize-templates.html">Using and Customizing Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmake-options.html">CMake Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure-project.html">Configure a Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage-data.html">Managing Test Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="document.html">Documenting Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="branch-and-release.html">Branch and Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="package.html">Packaging Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Install any Software</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Automated Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-basistest-family-of-scripts">The basistest family of scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdash-integration">CDash Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#administration-of-software-testing">Administration of Software Testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../standard.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guideline.html">Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc.html">API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

<h3>External Links</h3>
<ul>
  <li><a href="https://github.com/cmake-basis/BASIS">Repository</a></ li>
  <li><a href="https://github.com/cmake-basis/BASIS/issues">Issues</a></ li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2011-12 University of Pennsylvania, 2013-14 Carnegie Mellon University, 2013-16 Andreas Schuh.
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
  </div>
  
  </body>
</html>